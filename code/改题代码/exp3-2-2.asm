;16位灯循环
A8255 EQU 0640H
B8255 EQU 0642H
C8255 EQU 0644H
MODE8255 EQU 0646H
 
DATA SEGMENT
     FLAG DB 00H ;定义了一个叫FLAG的8位字节变量
DATA ENDS
 
CODE SEGMENT
	ASSUME CS:CODE,DS:DATA
START:
    MOV AX,DATA
    MOV DS,AX;把DATA段的地址加载到DS中，后续才可访问FLAG
    
    MOV DX,MODE8255
    MOV AL,80H
    OUT DX,AL
    
	PUSH DS
	MOV AX,0000H
	MOV DS,AX
	
	MOV AX,OFFSET MIR7
	MOV SI,003CH
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003EH
	MOV [SI],AX
	
	MOV AX,OFFSET MIR6
	MOV SI,0038H
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX
	POP DS
 
    CLI
 
	MOV AL,11H;ICW1
	OUT 20H,AL
	MOV AL,08H;ICW2
	OUT 21H,AL
	MOV AL,04H;ICW3
	OUT 21H,AL
	MOV AL,07H;ICW4
	OUT 21H,AL
	MOV AL,2FH;OCW1 开IR6 IR7以及串口
	OUT 21H,AL
	
	STI
	
    MOV DX,B8255
    MOV AL,80H;80H=10000000B，最高位D7亮

    OUT DX,AL
 
    MOV FLAG,00H
    MOV BX,0080H
MAIN:
    CMP FLAG,00H
    JE EXIT
    CMP FLAG,01H
    JE L
    ROR BX,1;ROR是循环右移指令。它将AL中的所有位向右移动一位，最右边被移出去的位会补到最左边。
    JMP EXIT
L:
    ROL BX,1
    
EXIT:
    PUSH BX
    
    ; 输出低8位 (BL) 到 B口
    MOV AL, BL
    MOV DX, B8255
    OUT DX, AL
    
    ; 输出高8位 (BH) 到 A口
    MOV AL, BH
    MOV DX, A8255
    OUT DX, AL
    
    POP BX
    CALL DELAY
    JMP MAIN
    
MIR6:
    STI
    MOV FLAG,02H
	IRET
	
MIR7:
    STI
    MOV FLAG,01H
    IRET
	
DELAY:  
    PUSH CX
	MOV CX,0F000H
A0:		
    PUSH AX
	POP  AX
	LOOP A0
	POP CX	
	RET
	
CODE ENDS
     END START 